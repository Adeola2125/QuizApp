<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY QUIZ</title>
    <link rel="stylesheet" href="./categoryModule.css">
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</head>
<body>
    <div class="container-fluid">
        <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand pl-5" href="#">MY QUIZ</a>
            <!-- <p class=" text-primary">DASHBOARD</p> -->
            <!-- <a href="#" class="btn btn-primary ml-auto mr-5"><i class="fa fa-plus-circle" aria-hidden="true"></i> Create New Quiz</a> -->
            <li class="row nav-item dropdown d-none d-md-block ml-auto">
                <img style="width: 50px; height: 50px; border-radius: 100%;" src="./Quiz logo.jpg" alt="">
                <a class="nav-link1 dropdown-toggle text-dark pt-3 pl-3" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-expanded="false"></a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="#">Action</a>
                  <a class="dropdown-item" href="#">Another action</a>
                  <a class="dropdown-item" href="#">Something else here</a>
                </div>
                <span class="pt-3 pl-2" style="font-size: 15px;">ADMIN</span>
              </li>
          </nav>
          <div class="row pt-5">
            <div class="col-md-2 pt-5" style="border-right: 1px solid white;background-color: #001a2f;">
              <div class="pt-3 text-white">
                <div class="col-sm-12" style="padding-left: 70px;">
                    <img style="width: 50px; height: 50px; border-radius: 100%;" src="./Quiz logo.jpg" alt="">
                </div>
                <div class="col-sm-12 mt-2 text-center">
                    <h5 id="adminName"></h5>
                    <p class="">Web Developer</p>
                </div>
              </div>
            </div>
            <div class="col-md-10 pt-2 text-white" style="background-color: #001a2f;">
                <h5><i class="fa fa-bars pt-5" aria-hidden="true"></i> CATEGORY MODULE</h5>
                <div class="row">
                    <div class="col-md-8">
                      <h4 id="username"></h4>
                      <p>All systems are running smoothly!</p>
                    </div>
                  
                  <div class="col-md-4">
                      <p class="ml-auto" id="cloock"><i class="fa fa-home mr-1" aria-hidden="true"></i>Dashboard  <i class="fa fa-angle-right" style="font-size: small;" aria-hidden="true"></i>  Category Module</p>
                  </div>
                </div>
            </div>
          </div>
          <div class="row" style="height: 100vh;">
            <div class="col-md-2 bg-light text-dark">
                  <h6 style="background-color: #ffffff; font-size: small;" class="text-center text-muted mt-5"><span style="border-radius: 15%;">MODULE</span></h6>
                <ul class="navbar-nav pt-3 text-dark" style="font-size: 14px;">
                    <li class="nav-item">
                        <a class="nav-link" href="./dashboard.html"><i class="fa fa-home mr-2" aria-hidden="true"></i>DASHBOARD</a>
                      </li>
                    <li class="nav-item active">
                      <a class="nav-link" href="./categoryModule.html"><i class="fa fa-bars" aria-hidden="true"></i> MANAGE CATEGORY <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="./manageQuiz.html"><i class="fa fa-tasks mr-2" aria-hidden="true"></i> MANAGE QUIZ</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="#"><i class="fa fa-star mr-2" aria-hidden="true"></i> ACTIVATE QUIZ</a>
                    </li>
                  </ul>
                  <hr style="background-color: #001a2f;">
                  <ul class="navbar-nav text-dark" style="font-size: 14px;">
                    <li class="nav-item">
                      <a class="nav-link" href="./quizHistory.html"><i class="fa fa-certificate" aria-hidden="true"></i> QUIZ HISTORY</a>
                    </li>
                  </ul>
              </div>
              <div class="col-md-10 pb-4 text-white" style="background-color: #001a2f;">
                  <div class="row mt- text-white">
                    <div class="col-sm-4">
                        <div class="card card1">
                          <div class="card-body">
                            <h5 class="card-title number" id="catCount">0</h5>
                            <p class="card-text text-white">Total No. of Categories.</p>
                            <!-- <a href="#" class="btn btn-white">Go somewhere</a> -->
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-4">
                        <div class="card card1">
                          <div class="card-body">
                            <h5 class="card-title number" id="live">0</h5>
                            <p class="card-text text-white">Total No. of Live Quiz.</p>
                            <!-- <a href="#" class="btn btn-white">Go somewhere</a> -->
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-4">
                          <div class="card card1">
                            <div class="card-body">
                              <h5 class="card-title number" id="notLive">0</h5>
                              <p class="card-text text-white">Total No. of Not~Live Quiz.</p>
                              <!-- <a href="#" class="btn btn-white">Go somewhere</a> -->
                            </div>
                          </div>
                        </div>
                  </div>
                  <div class="col-sm-12 mt-5 caterogiesactivites">
                      <div class="row mb-4 pt-3">
                        <h4 class="ml-3">Quiz Categories</h4>

                        <button class="btn btn-primary ml-auto mr-4" type="button" data-toggle="modal" data-target="#myModal" id="modal">
                            <i class="fa fa-plus-circle mr-1" aria-hidden="true"></i>
                            Edit category
                        </button>
        
                        <!-- The Modal -->
                    <div class="modal fade modal animate__animated animate__jackInTheBox" id="myModal">
                        <div class="modal-dialog">
                        <div class="modal-content">
                        
                            <!-- Modal Header -->
                            <div class="modal-header">
                            <h4 class="modal-title">Create Categories<i class="fa fa-graduation-cap ml-2" aria-hidden="true"></i></h4>
                            <button type="button" class="close" data-dismiss="modal">×</button>
                            </div>
                            
                            <!-- Modal body -->
                            <div class="modal-body">
                                <form action="">
                                    <div class="input-group mb-2">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">
                                                Category Name
                                            </span>
                                        </div>
                                        <input type="text" class="form-control" name="" id="categoryName">
                                    </div>
                                    <div class="input-group mb-2">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">
                                                Status
                                            </span>
                                        </div>
                                        <select name="" id="categoryStatus">
                                            <option value="">Select option...</option>
                                        </select>
                                    </div>
                                    
                                </form>
                            </div>
                            
                            <!-- Modal footer -->
                            <div class="modal-footer">
                            <button type="button" class="btn btn-primary"data-dismiss="modal" id="addCategories" onclick="addCategories()">Add Categories</button>
                            </div>
                            
                        </div>
                        </div>
                    </div> 
                    </div>
                    <table border="1" class="col-sm-12">
                        <thead>
                            <tr>
                                <th>S/N</th>
                                <th>Name</th>
                                <!-- <th>Email</th> -->
                                <th>User Type</th>
                                <!-- <th>Joined</th> -->
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                             <!-- The Modal -->
                    <div class="modal fade modal animate__animated animate__backInDown" id="myEditModal">
                        <div class="modal-dialog">
                        <div class="modal-content">
                        
                            <!-- Modal Header -->
                            <div class="modal-header">
                            <h4 class="modal-title">Create Categories<i class="fa fa-graduation-cap ml-2" aria-hidden="true"></i></h4>
                            <button type="button" class="close" data-dismiss="modal">×</button>
                            </div>
                            
                            <!-- Modal body -->
                            <div class="modal-body">
                                <form action="">
                                    <div class="input-group mb-2">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">
                                                Category Name
                                            </span>
                                        </div>
                                        <input type="text" class="form-control" name="" id="categoryModalName">
                                    </div>
                                    <div class="input-group mb-2">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">
                                                Status
                                            </span>
                                        </div>
                                        <select name="" id="categoryModalStatus">
                                            <option value="">Select option...</option>
                                        </select>
                                    </div>
                                    
                                </form>
                            </div>
                            
                            <!-- Modal footer -->
                            <div class="modal-footer">
                            <button type="button" class="btn btn-primary"data-dismiss="modal" id="updateButton" onclick="updateButton()">Update</button>
                            </div>
                            
                        </div>
                        </div>
                    </div> 
                        </tbody>
                    </table>
                  </div>
              </div>
          </div>
    </div>
     <!-- jQuery library -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>

<!-- Popper JS -->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let modal = document.getElementById("modal");
    let categoryName = document.getElementById("categoryName");
    let categoryModalName = document.getElementById("categoryModalName");
    let categoryStatus = document.getElementById("categoryStatus");
    let categoryModalStatus = document.getElementById("categoryModalStatus");
    let tbody = document.getElementById("tbody");
    let seedCategoryData=[
    {
        "id": 164142,
        "name": "General Knowledge",
        "status": "LIVE",
        "userType": "Admin"
    },
    {
        "id": 442014,
        "name": "HTML",
        "status": "LIVE",
        "userType": "Admin"
    },
    {
        "id": 811130,
        "name": "CSS",
        "status": "LIVE",
        "userType": "Admin"
    },
    {
        "id": 691764,
        "name": "JAVASCRIPT",
        "status": "LIVE",
        "userType": "Admin"
    },
    {
        "id": 996595,
        "name": "PHP",
        "status": "LIVE",
        "userType": "Admin"
    },
    {
        "id": 543606,
        "name": "NODE.JS",
        "status": "LIVE",
        "userType": "Admin"
    }
]
seedCategory()
function seedCategory(){
    let duplicateEntry=false;
    if(localStorage.getItem('myData') == null) {
      localStorage.setItem('myData', JSON.stringify(seedCategoryData))
    } else {
      let records = JSON.parse(localStorage.getItem('myData'));
      
      records.forEach(item => {
        seedCategoryData.forEach(item2 => {
            if(item2.name == item.name){
                return duplicateEntry=true 
            }
        })
      })
      if(!duplicateEntry) {

          localStorage.setItem('myData', JSON.stringify(records))
      }
    }
}
    
    let xy = "";

    let myArr = [
        {status: "LIVE"},
        {status: "NOT LIVE"}
    ]

    for (let i = 0; i < myArr.length; i++){
            categoryStatus.innerHTML += `<option value="${myArr[i].status}">${myArr[i].status}</option>`;
            categoryModalStatus.innerHTML += `<option value="${myArr[i].status}">${myArr[i].status}</option>`;

        }
        var myData = JSON.parse(localStorage.getItem("myData"));
        
    

    function Refetch(){
        var myData = JSON.parse(localStorage.getItem("myData")) || null;
        if(myData !== null) {
            // console.log(myData);
            tbody.innerHTML = "";  
            let catCount = 0;
            let notLive = 0;
            let Live = 0;
        
            myData.forEach((element, a) => {
                catCount = Number(a + 1);
                // notLive = Number(a + 1)
                tbody.innerHTML += 
                `
                <tr style="text-align: center;">
                    <td>${a + 1}</td>
                    <td class="ml-5">${element.name}</td>
                    <td class="ml-auto">${element.userType}</td>
                    <td class="ml-auto"><em>${element.status}</em></td>
                    <td class="ml-auto">
                        <i class="fa fa-th" aria-hidden="true" style="font-size: 22px; margin: auto;></i>
                    <div class="dropdown">
                      <button class="btn dropdown-toggle text-white" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-expanded="false">
                        
                      </button>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                        <button class="dropdown-item" type="button" onclick="deleteAction(${a})">Delete <i class="fas fa-trash" style="color: red;" aria-hidden="true"></i></button>
                        <button class="dropdown-item" type="button" id="trash" data-toggle="modal" data-target="#myEditModal" onclick="editAction(${element.id})">Edit <i class="fas fa-pen edit ml-4" style="color: blue;" aria-hidden="true" ></i></button>
                      </div>
                    </div>
                    </td>
                </tr>

                `
                if(element.status == "NOT LIVE"){
                    notLive++
                };
                if(element.status == "LIVE"){
                    document.getElementById("live").innerHTML = Live++
                }
                // localStorage.setItem('myData', JSON.stringify(myData))
            });
            document.getElementById("notLive").innerHTML = notLive
            document.getElementById("live").innerHTML = Live
            document.getElementById("catCount").innerHTML = myData.length
            // document.getElementById("notLive").innerHTML = notLive
        }
    }
    Refetch()

    function addCategories(add){
        let catData = JSON.parse(localStorage.getItem("myData")) || null;
        let status = false
        let duplicateStatus = false

        if(categoryName.value == "" || categoryStatus.value == ""){
            return swal({
                title: "Please set category",
                icon: "warning"
            }); 
        }
        let data = {
            id: Math.floor(Math.random() * 1000000),
            name: categoryName.value,
            status: categoryStatus.value,
            userType: "Admin"
        }
        
        
        let arr = [];
        if(catData == null){
               arr.push(data)
           }
           else{
            arr = catData
                
               for(let i = 0; i < arr.length; i++){
                   if(data.name == arr[i].name){
                       status = true
                   }
               }
               if(status) {
                    return swal({
                       title: "Duplicate Entry Detected"
                   });
                }
               
                else{
                    arr.push(data)
                    categoryName.value = ""
                }
           }
           
           localStorage.setItem('myData', JSON.stringify(arr))
           Refetch()
    }

    function deleteAction(a){
            // alert(a);
            swal({
                title: "Are you sure?",
                text: 'Item will be deleted from list!',
                icon: "warning",
                buttons: true,
                dangerMode: true
           } )
            .then ((willDelete) => {
             if (willDelete) {

                    var catData = JSON.parse(localStorage.getItem('myData'));

                    if(catData){
                        catData.splice(a, 1)
                        localStorage.setItem('myData', JSON.stringify(catData))
                    }
                    Refetch()
                    swal("Item Deleted!", {
                        icon: "success",
                    });
            
                }
                else {
                    Refetch()
                    swal("Item still in cart!")
                }
            });
        }
        function editAction(ind){
            xy = ind;
            // alert(xy);
            let value = "";
            let data = {
                name: categoryName.value,
                status: categoryStatus.value,
            }

            var catData = JSON.parse(localStorage.getItem('myData'));
            
            for(let i = 0; i < catData.length; i++){
                if(catData[i].id == ind){
                    value = catData[i]
                }
            }
            categoryModalName.value = value.name;
            categoryModalStatus.value = value.status;
            Refetch()
            
        }
        function updateButton(){
            // let inputValue = document.getElementById("todoInput");
            let data = {
                name: categoryName.value,
                status: categoryStatus.value,
            }
            // alert(xy)

            let catData = JSON.parse(localStorage.getItem('myData'));
            if (categoryModalName.value == "" || categoryModalStatus.value == ""){
                return swal({
                    title: "Cannot update empty category",
                    icon: "warning"
                })
            }
            else{
                // alert('Working')
                for(let i = 0; i < catData.length; i++){
                    if(catData[i].id == xy){
                        catData[i].name = categoryModalName.value;
                        catData[i].status = categoryModalStatus.value;
                    }
                }
                categoryModalName.value = "";
                categoryModalStatus.value = "";
            }
            localStorage.setItem("myData", JSON.stringify(catData));
            Refetch()

        }

        // const clock = document.getElementById("clock");
        // const tick = () =>{
        //     const time = new Date()
        //     const h = time.getHours();
        //     const m = time.getMinutes();
        //     const s = time.getSeconds();

        //     const myTime =
        //     `<span>${time}</span>`
        //     clock.innerHTML = myTime
        // }
        // setInterval(tick, 1000)

    //     var adminName = document.getElementById("adminName")
    //     let auth = JSON.parse(localStorage.getItem("authUser"))
    //    if(auth){
    //     adminName.innerHTML = auth.name
    //    }
    //    else{
    //        window.location.assign("signuppage.html")
    //    }
</script>
</body>
</html>